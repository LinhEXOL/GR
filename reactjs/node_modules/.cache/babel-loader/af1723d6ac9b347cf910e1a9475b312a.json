{"ast":null,"code":"import _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport * as React from 'react';\nimport Icon from '../../components/Icon';\nimport i18n from '../../i18n';\nimport { PluginComponent } from '../Plugin';\nimport LoggerPlugin from './logger';\nvar LOGGER_INTERVAL = 600;\nvar Logger = /*#__PURE__*/function (_PluginComponent) {\n  _inheritsLoose(Logger, _PluginComponent);\n  function Logger(props) {\n    var _this;\n    _this = _PluginComponent.call(this, props) || this;\n    _this.handleKeyboards = [];\n    _this.lastPop = null;\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handleRedo = _this.handleRedo.bind(_assertThisInitialized(_this));\n    _this.handleUndo = _this.handleUndo.bind(_assertThisInitialized(_this)); // Mac的Redo比较特殊，是Command+Shift+Z，优先处理\n\n    _this.handleKeyboards = [{\n      key: 'y',\n      keyCode: 89,\n      withKey: ['ctrlKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      withKey: ['metaKey', 'shiftKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      aliasCommand: true,\n      withKey: ['ctrlKey'],\n      callback: _this.handleUndo\n    }];\n    _this.logger = new LoggerPlugin();\n    return _this;\n  }\n  var _proto = Logger.prototype;\n  _proto.handleUndo = function handleUndo() {\n    var last = this.logger.undo(this.editor.getMdValue());\n    if (typeof last !== 'undefined') {\n      this.pause();\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n  _proto.handleRedo = function handleRedo() {\n    var last = this.logger.redo();\n    if (typeof last !== 'undefined') {\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n  _proto.handleChange = function handleChange(value, e, isChange) {\n    var _this2 = this;\n    if (this.logger.getLast() === value || this.lastPop !== null && this.lastPop === value) {\n      return;\n    }\n    this.logger.cleanRedo();\n    if (isChange) {\n      this.logger.push(value);\n      this.lastPop = null;\n      this.forceUpdate();\n      return;\n    }\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = 0;\n    }\n    this.timerId = window.setTimeout(function () {\n      if (_this2.logger.getLast() !== value) {\n        _this2.logger.push(value);\n        _this2.lastPop = null;\n        _this2.forceUpdate();\n      }\n      window.clearTimeout(_this2.timerId);\n      _this2.timerId = 0;\n    }, LOGGER_INTERVAL);\n  };\n  _proto.componentDidMount = function componentDidMount() {\n    var _this3 = this;\n\n    // 监听变化事件\n    this.editor.on('change', this.handleChange); // 监听键盘事件\n\n    this.handleKeyboards.forEach(function (it) {\n      return _this3.editor.onKeyboard(it);\n    }); // 初始化时，把已有值填充进logger\n\n    this.logger.initValue = this.editor.getMdValue();\n    this.forceUpdate();\n  };\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    var _this4 = this;\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n    }\n    this.editor.off('change', this.handleChange);\n    this.handleKeyboards.forEach(function (it) {\n      return _this4.editor.offKeyboard(it);\n    });\n  };\n  _proto.pause = function pause() {\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = undefined;\n    }\n  };\n  _proto.render = function render() {\n    var hasUndo = this.logger.getUndoCount() > 1 || this.logger.initValue !== this.editor.getMdValue();\n    var hasRedo = this.logger.getRedoCount() > 0;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-undo \" + (hasUndo ? '' : 'disabled'),\n      title: i18n.get('btnUndo'),\n      onClick: this.handleUndo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"undo\"\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-redo \" + (hasRedo ? '' : 'disabled'),\n      title: i18n.get('btnRedo'),\n      onClick: this.handleRedo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"redo\"\n    })));\n  };\n  return Logger;\n}(PluginComponent);\nLogger.pluginName = 'logger';\nexport { Logger as default };","map":{"version":3,"names":["_assertThisInitialized","_inheritsLoose","React","Icon","i18n","PluginComponent","LoggerPlugin","LOGGER_INTERVAL","Logger","_PluginComponent","props","_this","call","handleKeyboards","lastPop","handleChange","bind","handleRedo","handleUndo","key","keyCode","withKey","callback","aliasCommand","logger","_proto","prototype","last","undo","editor","getMdValue","pause","setText","forceUpdate","redo","value","e","isChange","_this2","getLast","cleanRedo","push","timerId","window","clearTimeout","setTimeout","componentDidMount","_this3","on","forEach","it","onKeyboard","initValue","componentWillUnmount","_this4","off","offKeyboard","undefined","render","hasUndo","getUndoCount","hasRedo","getRedoCount","createElement","Fragment","className","title","get","onClick","type","pluginName","default"],"sources":["C:/Users/admin/Downloads/GR2/reactjs/node_modules/react-markdown-editor-lite/esm/plugins/logger/index.js"],"sourcesContent":["import _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport * as React from 'react';\nimport Icon from '../../components/Icon';\nimport i18n from '../../i18n';\nimport { PluginComponent } from '../Plugin';\nimport LoggerPlugin from './logger';\nvar LOGGER_INTERVAL = 600;\n\nvar Logger = /*#__PURE__*/function (_PluginComponent) {\n  _inheritsLoose(Logger, _PluginComponent);\n\n  function Logger(props) {\n    var _this;\n\n    _this = _PluginComponent.call(this, props) || this;\n    _this.handleKeyboards = [];\n    _this.lastPop = null;\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handleRedo = _this.handleRedo.bind(_assertThisInitialized(_this));\n    _this.handleUndo = _this.handleUndo.bind(_assertThisInitialized(_this)); // Mac的Redo比较特殊，是Command+Shift+Z，优先处理\n\n    _this.handleKeyboards = [{\n      key: 'y',\n      keyCode: 89,\n      withKey: ['ctrlKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      withKey: ['metaKey', 'shiftKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      aliasCommand: true,\n      withKey: ['ctrlKey'],\n      callback: _this.handleUndo\n    }];\n    _this.logger = new LoggerPlugin();\n    return _this;\n  }\n\n  var _proto = Logger.prototype;\n\n  _proto.handleUndo = function handleUndo() {\n    var last = this.logger.undo(this.editor.getMdValue());\n\n    if (typeof last !== 'undefined') {\n      this.pause();\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleRedo = function handleRedo() {\n    var last = this.logger.redo();\n\n    if (typeof last !== 'undefined') {\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleChange = function handleChange(value, e, isChange) {\n    var _this2 = this;\n\n    if (this.logger.getLast() === value || this.lastPop !== null && this.lastPop === value) {\n      return;\n    }\n\n    this.logger.cleanRedo();\n\n    if (isChange) {\n      this.logger.push(value);\n      this.lastPop = null;\n      this.forceUpdate();\n      return;\n    }\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = 0;\n    }\n\n    this.timerId = window.setTimeout(function () {\n      if (_this2.logger.getLast() !== value) {\n        _this2.logger.push(value);\n\n        _this2.lastPop = null;\n\n        _this2.forceUpdate();\n      }\n\n      window.clearTimeout(_this2.timerId);\n      _this2.timerId = 0;\n    }, LOGGER_INTERVAL);\n  };\n\n  _proto.componentDidMount = function componentDidMount() {\n    var _this3 = this;\n\n    // 监听变化事件\n    this.editor.on('change', this.handleChange); // 监听键盘事件\n\n    this.handleKeyboards.forEach(function (it) {\n      return _this3.editor.onKeyboard(it);\n    }); // 初始化时，把已有值填充进logger\n\n    this.logger.initValue = this.editor.getMdValue();\n    this.forceUpdate();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    var _this4 = this;\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n    }\n\n    this.editor.off('change', this.handleChange);\n    this.handleKeyboards.forEach(function (it) {\n      return _this4.editor.offKeyboard(it);\n    });\n  };\n\n  _proto.pause = function pause() {\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = undefined;\n    }\n  };\n\n  _proto.render = function render() {\n    var hasUndo = this.logger.getUndoCount() > 1 || this.logger.initValue !== this.editor.getMdValue();\n    var hasRedo = this.logger.getRedoCount() > 0;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-undo \" + (hasUndo ? '' : 'disabled'),\n      title: i18n.get('btnUndo'),\n      onClick: this.handleUndo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"undo\"\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-redo \" + (hasRedo ? '' : 'disabled'),\n      title: i18n.get('btnRedo'),\n      onClick: this.handleRedo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"redo\"\n    })));\n  };\n\n  return Logger;\n}(PluginComponent);\n\nLogger.pluginName = 'logger';\nexport { Logger as default };"],"mappings":"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"},"metadata":{},"sourceType":"module"}